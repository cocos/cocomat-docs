(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{458:function(s,t,e){"use strict";e.r(t);var a=e(65),r=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"ccmresleakchecker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ccmresleakchecker"}},[s._v("#")]),s._v(" CCMResLeakChecker")]),s._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),e("p",[e("code",[s._v("CCMResLeakChecker")]),s._v(" 为内存泄露检查工具，支持追踪某种特定资源的所有"),e("code",[s._v("addRef")]),s._v("和"),e("code",[s._v("decRef")]),s._v("的堆栈，需要与"),e("code",[s._v("CCMResLoader")]),s._v("结合使用，主要支持以下接口")]),s._v(" "),e("ul",[e("li",[s._v("startCheck 开始检查")]),s._v(" "),e("li",[s._v("stopCheck 结束检查")]),s._v(" "),e("li",[s._v("reset 重置（清空收集到的堆栈）")]),s._v(" "),e("li",[s._v("getTraceAssets 获取跟踪到的堆栈信息")]),s._v(" "),e("li",[s._v("dump 在控制台dump堆栈信息")])]),s._v(" "),e("p",[s._v("资源过滤，通过设置"),e("code",[s._v("CCMResLeakChecker")]),s._v("实例的"),e("code",[s._v("resFilter")]),s._v("属性，可以判断传入的资源是否需要进行内存泄露检查，"),e("code",[s._v("resFilter")]),s._v("的函数原型如下")]),s._v(" "),e("div",{staticClass:"language-ts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ts"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FilterCallback")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("asset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" cc"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Asset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("boolean")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),e("h2",{attrs:{id:"使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),e("p",[s._v("初始化"),e("code",[s._v("CCMResLeakChecker")]),s._v("，设置到"),e("code",[s._v("CCMResLoader.resLeakChecker")]),s._v("中，在准备开始检查的时候调用"),e("code",[s._v("startCheck")]),s._v("，然后正常地加载资源，调用"),e("code",[s._v("addRef")]),s._v("和"),e("code",[s._v("decRef")]),s._v("使用资源")]),s._v(" "),e("div",{staticClass:"language-ts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ts"}},[e("code",[s._v("        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" checker "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CCMResLeakChecker")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        checker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("startCheck")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        CCMResLoader"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("resLeakChecker "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" checker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),e("p",[s._v("追踪到的资源堆栈信息可以直接dump，在控制台输出")]),s._v(" "),e("div",{staticClass:"language-ts extra-class"},[e("pre",{pre:!0,attrs:{class:"language-ts"}},[e("code",[s._v("        CCMResLoader"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("resLeakChecker"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("dump")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);